<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Manifest | ALM</title>
    <link rel="icon" href="/logo.svg" type="image/svg+xml">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #050505;
            --card: #0a0a0a;
            --border: #1a1a1a;
            --border-light: #252525;
            --accent: #4a9eff;
            --accent-dim: rgba(74,158,255,0.12);
            --text: #ffffff;
            --text-sec: #888888;
            --text-dim: #444444;
            --green: #22c55e;
            --yellow: #f59e0b;
            --purple: #a78bfa;
        }

        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* NAV */
        nav {
            position: sticky;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 40px;
            background: rgba(5,5,5,0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            z-index: 99;
        }
        .nav-logo {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        .nav-logo span { color: var(--accent); }
        .nav-links { display: flex; gap: 8px; align-items: center; }
        .nav-links a {
            font-size: 13px;
            color: var(--text-sec);
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .nav-links a:hover { color: var(--text); background: rgba(255,255,255,0.05); }
        .nav-badge {
            font-size: 11px;
            padding: 3px 8px;
            background: var(--accent-dim);
            border: 1px solid rgba(74,158,255,0.25);
            border-radius: 20px;
            color: var(--accent);
            font-weight: 600;
        }

        /* HERO */
        .hero {
            padding: 56px 40px 32px;
            max-width: 900px;
            margin: 0 auto;
        }
        .hero-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--accent);
            background: var(--accent-dim);
            border: 1px solid rgba(74,158,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .hero-tag::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

        .hero h1 {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -0.03em;
            margin-bottom: 10px;
        }
        .hero h1 span { color: var(--accent); }
        .hero-sub {
            font-size: 15px;
            color: var(--text-sec);
            max-width: 540px;
            margin-bottom: 28px;
        }
        .hero-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 0;
        }
        .btn-copy {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 9px 18px;
            background: var(--accent);
            border: none;
            border-radius: 7px;
            color: #000;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-copy:hover { background: #5aa8ff; }
        .btn-raw {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 9px 18px;
            background: transparent;
            border: 1px solid var(--border-light);
            border-radius: 7px;
            color: var(--text-sec);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
        }
        .btn-raw:hover { border-color: var(--accent); color: var(--accent); }

        /* MAIN */
        .page { max-width: 900px; margin: 0 auto; padding: 0 40px 80px; }

        /* LOADING */
        .loading {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 40px 0;
            color: var(--text-sec);
            font-size: 14px;
        }
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-light);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* CARDS */
        .section { margin-bottom: 32px; }
        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-dim);
            margin-bottom: 12px;
        }

        .info-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        @media(max-width:600px){ .info-grid { grid-template-columns: 1fr; } }

        .info-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .info-label {
            font-size: 11px;
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .info-value {
            font-size: 14px;
            color: var(--text);
            font-weight: 500;
            word-break: break-all;
        }
        .info-value.mono {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 12px;
            color: var(--accent);
            background: var(--accent-dim);
            padding: 4px 8px;
            border-radius: 5px;
        }
        .info-value.full {
            grid-column: 1 / -1;
        }

        /* STATUS BADGE */
        .status-dot {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
        }
        .status-dot::before {
            content:'';
            width: 7px;
            height: 7px;
            background: var(--green);
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        /* SKILLS */
        .skills-list { display: flex; flex-direction: column; gap: 10px; }
        .skill-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px 20px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 12px;
            align-items: start;
            transition: border-color 0.2s;
        }
        .skill-item:hover { border-color: var(--border-light); }
        .skill-icon {
            width: 36px;
            height: 36px;
            background: var(--accent-dim);
            border: 1px solid rgba(74,158,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            flex-shrink: 0;
        }
        .skill-body {}
        .skill-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
        }
        .skill-desc {
            font-size: 12px;
            color: var(--text-sec);
        }
        .skill-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }
        .skill-category {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(167,139,250,0.1);
            border: 1px solid rgba(167,139,250,0.2);
            color: var(--purple);
            font-weight: 600;
        }
        .skill-handler {
            font-size: 10px;
            color: var(--text-dim);
            font-family: monospace;
        }
        .skill-params {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .param-tag {
            font-size: 11px;
            padding: 2px 7px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-sec);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .param-req { color: #f87171; font-size: 10px; }

        /* CAPABILITIES */
        .caps-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .cap-badge {
            font-size: 12px;
            padding: 5px 12px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-sec);
        }

        /* CONFIG */
        .config-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .config-table tr { border-bottom: 1px solid var(--border); }
        .config-table tr:last-child { border-bottom: none; }
        .config-table td { padding: 10px 0; vertical-align: top; }
        .config-table td:first-child {
            color: var(--text-dim);
            width: 40%;
            font-size: 12px;
            font-weight: 500;
            padding-right: 16px;
        }

        /* JSON DUMP */
        .json-block {
            background: #080808;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 12px;
            color: #7ec8e3;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.7;
        }

        /* COPY TOAST */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--green);
            color: #000;
            font-size: 13px;
            font-weight: 600;
            padding: 10px 18px;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(8px);
            transition: all 0.2s;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

<nav>
    <a href="/" style="display:flex;align-items:center;gap:8px;text-decoration:none;">
      <img src="/logo.svg" alt="ALM" style="width:32px;height:32px;border-radius:7px;">
      <span class="nav-logo" style="margin:0;">ALM <span style="color:var(--text-dim);font-weight:400">/ Manifest</span></span>
    </a>
    <div class="nav-links">
        <a href="/">Chat</a>
        <a href="/agent">Profile</a>
        <a href="/registry">Registry</a>
        <a href="https://github.com/gish1337/alm-agent" target="_blank">GitHub</a>
        <span class="nav-badge">OpenClaw</span>
    </div>
</nav>

<div class="hero">
    <div class="hero-tag">Agent Manifest</div>
    <h1>Skill <span>Manifest</span></h1>
    <p class="hero-sub">Machine-readable capability declaration for OpenClaw and inter-agent discovery.</p>
    <div class="hero-actions">
        <button class="btn-copy" onclick="copyJson()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            Copy JSON
        </button>
        <a class="btn-raw" href="/api/agent/manifest" target="_blank">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            Raw JSON
        </a>
    </div>
</div>

<div class="page">
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>Loading manifest...</span>
    </div>

    <div id="content" style="display:none">

        <!-- Agent Info -->
        <div class="section">
            <div class="section-title">Agent Identity</div>
            <div class="info-card">
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">Name</span>
                        <span class="info-value" id="m-name">—</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value"><span class="status-dot">Active</span></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Version</span>
                        <span class="info-value" id="m-version">—</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Protocol</span>
                        <span class="info-value" id="m-protocol">—</span>
                    </div>
                    <div class="info-row" style="grid-column:1/-1">
                        <span class="info-label">Description</span>
                        <span class="info-value" id="m-desc">—</span>
                    </div>
                    <div class="info-row" style="grid-column:1/-1">
                        <span class="info-label">Wallet Address</span>
                        <span class="info-value mono" id="m-wallet">—</span>
                    </div>
                    <div class="info-row" style="grid-column:1/-1">
                        <span class="info-label">Agent ID</span>
                        <span class="info-value mono" id="m-agentid">—</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills -->
        <div class="section" id="skills-section" style="display:none">
            <div class="section-title">Skills</div>
            <div class="skills-list" id="skills-list"></div>
        </div>

        <!-- Capabilities -->
        <div class="section" id="caps-section" style="display:none">
            <div class="section-title">Capabilities</div>
            <div class="info-card">
                <div class="caps-grid" id="caps-list"></div>
            </div>
        </div>

        <!-- Config -->
        <div class="section" id="config-section" style="display:none">
            <div class="section-title">Config</div>
            <div class="info-card">
                <table class="config-table" id="config-table"></table>
            </div>
        </div>

        <!-- Stats -->
        <div class="section" id="stats-section" style="display:none">
            <div class="section-title">Stats</div>
            <div class="info-card">
                <table class="config-table" id="stats-table"></table>
            </div>
        </div>

        <!-- Raw JSON -->
        <div class="section">
            <div class="section-title">Raw JSON</div>
            <pre class="json-block" id="raw-json"></pre>
        </div>

    </div>
</div>

<div class="toast" id="toast">Copied to clipboard!</div>

<script>
const SKILL_ICONS = {
    'balance-checker': `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-4 0v2"/></svg>`,
    'price-monitor':   `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>`,
    'transaction-analyzer': `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>`,
    'network-status':  `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
};
const DEFAULT_ICON = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="9" x2="15" y2="9"/><line x1="9" y1="13" x2="15" y2="13"/></svg>`;

let rawManifest = null;

async function loadManifest() {
    try {
        const [mRes, aRes] = await Promise.all([
            fetch('/api/agent/manifest'),
            fetch('/api/agent')
        ]);
        const manifest = await mRes.json();
        const agentData = await aRes.json();
        rawManifest = manifest;

        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';

        // Identity
        document.getElementById('m-name').textContent     = manifest.agent?.name || '—';
        document.getElementById('m-version').textContent  = manifest.agent?.version || manifest.version || '—';
        document.getElementById('m-protocol').textContent = manifest.protocol || '—';
        document.getElementById('m-desc').textContent     = manifest.agent?.description || '—';
        document.getElementById('m-wallet').textContent   = agentData?.profile?.publicKey || '(not set)';
        document.getElementById('m-agentid').textContent  = agentData?.profile?.id || manifest.config?.agentId || '—';

        // Skills
        if (manifest.skills?.length) {
            document.getElementById('skills-section').style.display = 'block';
            const list = document.getElementById('skills-list');
            manifest.skills.forEach(skill => {
                const icon = SKILL_ICONS[skill.name] || DEFAULT_ICON;
                const params = (skill.parameters || []).map(p => `
                    <span class="param-tag">
                        ${p.name}
                        ${p.required ? '<span class="param-req">*</span>' : ''}
                    </span>`).join('');
                list.innerHTML += `
                <div class="skill-item">
                    <div class="skill-icon">${icon}</div>
                    <div class="skill-body">
                        <div class="skill-name">${skill.name}</div>
                        <div class="skill-desc">${skill.description || ''}</div>
                        ${params ? `<div class="skill-params">${params}</div>` : ''}
                    </div>
                    <div class="skill-meta">
                        <span class="skill-category">${skill.category || 'general'}</span>
                        <span class="skill-handler">${skill.handler ? skill.handler.substring(0,8)+'…' : ''}</span>
                    </div>
                </div>`;
            });
        }

        // Capabilities
        if (manifest.agent?.capabilities?.length) {
            document.getElementById('caps-section').style.display = 'block';
            const caps = document.getElementById('caps-list');
            manifest.agent.capabilities.forEach(c => {
                caps.innerHTML += `<span class="cap-badge">${c}</span>`;
            });
        }

        // Config
        if (manifest.config) {
            document.getElementById('config-section').style.display = 'block';
            const tbl = document.getElementById('config-table');
            Object.entries(manifest.config).forEach(([k, v]) => {
                tbl.innerHTML += `<tr><td>${k}</td><td>${JSON.stringify(v)}</td></tr>`;
            });
        }

        // Stats
        if (manifest.stats) {
            document.getElementById('stats-section').style.display = 'block';
            const tbl = document.getElementById('stats-table');
            Object.entries(manifest.stats).forEach(([k, v]) => {
                tbl.innerHTML += `<tr><td>${k}</td><td>${JSON.stringify(v)}</td></tr>`;
            });
        }

        // Raw JSON
        document.getElementById('raw-json').textContent = JSON.stringify(manifest, null, 2);

    } catch(e) {
        document.getElementById('loading').innerHTML = `<span style="color:#f87171">Failed to load manifest: ${e.message}</span>`;
    }
}

function copyJson() {
    if (!rawManifest) return;
    navigator.clipboard.writeText(JSON.stringify(rawManifest, null, 2)).then(() => {
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    });
}

loadManifest();
</script>
</body>
</html>
