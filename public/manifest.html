<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALM — Manifest</title>
    <link rel="icon" href="/logo.svg" type="image/svg+xml">
    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --accent:     #00d4ff;
            --accent-2:   #7c3aed;
            --bg:         #020206;
            --bg-card:    rgba(255,255,255,0.025);
            --bg-card-h:  rgba(255,255,255,0.05);
            --text:       #f0f0f4;
            --text-muted: rgba(240,240,244,0.5);
            --text-dim:   rgba(240,240,244,0.22);
            --border:     rgba(255,255,255,0.06);
            --border-a:   rgba(0,212,255,0.18);
            --green:      #22c55e;
            --green-dim:  rgba(34,197,94,0.1);
            --purple:     #a78bfa;
            --red:        #ef4444;
        }
        html { scroll-behavior: smooth; }
        body { font-family:'Inter',-apple-system,BlinkMacSystemFont,system-ui,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; -webkit-font-smoothing:antialiased; }
        .orb { position:fixed;border-radius:50%;filter:blur(140px);pointer-events:none;z-index:0; }
        .orb-1 { width:600px;height:600px;background:radial-gradient(circle,rgba(0,212,255,0.05) 0%,transparent 70%);top:-200px;left:-150px;animation:o1 22s ease-in-out infinite; }
        .orb-2 { width:400px;height:400px;background:radial-gradient(circle,rgba(124,58,237,0.045) 0%,transparent 70%);bottom:-80px;right:-80px;animation:o2 28s ease-in-out infinite; }
        @keyframes o1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(50px,40px)} }
        @keyframes o2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-40px,-50px)} }
        .grid-bg { position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,212,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.02) 1px,transparent 1px);background-size:80px 80px;mask-image:radial-gradient(ellipse 80% 50% at 50% 0%,black 0%,transparent 100%); }
        .z1 { position:relative;z-index:1; }
        #sp { position:fixed;top:0;left:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;z-index:1000;box-shadow:0 0 10px var(--accent);transition:width 0.08s linear; }
        nav { position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:0 72px;height:64px;background:rgba(2,2,6,0.82);backdrop-filter:blur(28px) saturate(180%);border-bottom:1px solid var(--border); }
        .nl { display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text); }
        .nl img { width:28px;height:28px;border-radius:6px; }
        .nl span { font-size:15px;font-weight:600;letter-spacing:-0.02em; }
        .nl-sub { color:var(--text-dim);font-weight:400; }
        .nr { display:flex;gap:4px;align-items:center; }
        .nr a { padding:6px 12px;color:var(--text-muted);text-decoration:none;font-size:13px;font-weight:500;border-radius:7px;transition:color 0.2s,background 0.2s; }
        .nr a:hover { color:var(--text);background:rgba(255,255,255,0.05); }
        .nbadge { padding:4px 11px;border-radius:100px;background:rgba(124,58,237,0.12);border:1px solid rgba(124,58,237,0.25);font-size:10px;font-weight:700;letter-spacing:0.06em;text-transform:uppercase;color:var(--purple); }
        .page { max-width:800px;margin:0 auto;padding:48px 24px 100px; }
        .hero-area { margin-bottom:40px;padding-bottom:32px;border-bottom:1px solid var(--border); }
        .hero-tag { font-size:11px;text-transform:uppercase;letter-spacing:0.1em;color:var(--accent);font-weight:700;margin-bottom:10px; }
        .hero-area h1 { font-size:36px;font-weight:800;letter-spacing:-0.04em;margin-bottom:8px;background:linear-gradient(135deg,#fff 0%,rgba(240,240,244,0.6) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
        .hero-area p { color:var(--text-muted);font-size:15px;margin-bottom:20px;max-width:520px;line-height:1.6; }
        .hero-actions { display:flex;gap:10px;flex-wrap:wrap; }
        .btn-copy { display:flex;align-items:center;gap:7px;padding:9px 18px;border:1px solid var(--border-a);background:rgba(0,212,255,0.07);color:var(--accent);font-size:13px;font-weight:600;border-radius:9px;cursor:pointer;transition:all 0.2s; }
        .btn-copy:hover { background:rgba(0,212,255,0.14);border-color:rgba(0,212,255,0.3); }
        .btn-raw { display:flex;align-items:center;gap:7px;padding:9px 18px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-muted);font-size:13px;font-weight:600;border-radius:9px;text-decoration:none;transition:all 0.2s; }
        .btn-raw:hover { color:var(--text);border-color:rgba(255,255,255,0.12); }
        .rv { opacity:0;transform:translateY(20px);transition:opacity 0.7s cubic-bezier(0.16,1,0.3,1),transform 0.7s cubic-bezier(0.16,1,0.3,1); }
        .rv.vis { opacity:1;transform:translateY(0); }
        .d1{transition-delay:.05s}.d2{transition-delay:.1s}.d3{transition-delay:.15s}
        .section { margin-bottom:28px; }
        .section-title { font-size:10px;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-dim);font-weight:600;margin-bottom:12px; }
        .card { background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:24px;position:relative;overflow:hidden; }
        .card::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,212,255,0.15),transparent); }
        .info-grid { display:grid;grid-template-columns:1fr 1fr;gap:16px 24px; }
        @media(max-width:600px){ .info-grid{grid-template-columns:1fr} nav{padding:0 20px} }
        .info-row { display:flex;flex-direction:column;gap:4px; }
        .info-label { font-size:10px;color:var(--text-dim);font-weight:600;text-transform:uppercase;letter-spacing:0.06em; }
        .info-value { font-size:14px;font-weight:500; }
        .info-value.mono { font-family:'SF Mono','Fira Code',monospace;font-size:11px;color:var(--accent);background:rgba(0,212,255,0.07);padding:4px 9px;border-radius:5px;border:1px solid rgba(0,212,255,0.12);word-break:break-all; }
        .info-value.full { grid-column:1/-1; }
        .status-dot { display:inline-flex;align-items:center;gap:7px;font-size:13px;font-weight:600;color:var(--green); }
        .sdot { width:6px;height:6px;background:var(--green);border-radius:50%;animation:sdotblink 2s infinite;box-shadow:0 0 8px var(--green); }
        @keyframes sdotblink { 0%,100%{opacity:1}50%{opacity:0.3} }
        .loading { display:flex;align-items:center;justify-content:center;height:340px;flex-direction:column;gap:14px;color:var(--text-dim); }
        .spinner { width:26px;height:26px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite; }
        @keyframes spin { to{transform:rotate(360deg)} }
        .skill-item { background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:16px 20px;display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:start;margin-bottom:10px;transition:border-color 0.2s,background 0.2s;position:relative;overflow:hidden; }
        .skill-item::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,212,255,0.1),transparent); }
        .skill-item:hover { border-color:var(--border-a);background:var(--bg-card-h); }
        .skill-icon { width:36px;height:36px;background:rgba(0,212,255,0.07);border:1px solid rgba(0,212,255,0.15);border-radius:9px;display:flex;align-items:center;justify-content:center;color:var(--accent);flex-shrink:0; }
        .skill-name { font-size:14px;font-weight:600;margin-bottom:3px; }
        .skill-desc { font-size:12px;color:var(--text-muted); }
        .skill-category { font-size:10px;padding:3px 9px;border-radius:100px;background:rgba(167,139,250,0.08);border:1px solid rgba(167,139,250,0.2);color:var(--purple);font-weight:600;text-transform:uppercase;letter-spacing:0.05em; }
        .skill-handler { font-size:10px;color:var(--text-dim);font-family:monospace;margin-top:4px; }
        .skill-params { margin-top:8px;display:flex;flex-wrap:wrap;gap:5px; }
        .param-tag { font-size:11px;padding:2px 8px;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);display:inline-flex;align-items:center;gap:4px; }
        .param-req { color:#f87171;font-size:10px; }
        .caps-grid { display:flex;flex-wrap:wrap;gap:8px; }
        .cap-badge { font-size:12px;padding:5px 12px;background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.15);border-radius:7px;color:var(--accent); }
        .cfg-row { display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px; }
        .cfg-row:last-child { border-bottom:none; }
        .cfg-key { color:var(--text-muted);font-size:12px;font-weight:500; }
        .cfg-val { font-weight:600; }
        .json-block { background:rgba(0,0,0,0.5);border:1px solid var(--border);border-radius:12px;padding:20px;font-family:'SF Mono','Fira Code',monospace;font-size:12px;color:var(--accent);white-space:pre-wrap;overflow-x:auto;max-height:400px;overflow-y:auto;line-height:1.7; }
        .toast { position:fixed;bottom:24px;right:24px;background:var(--green);color:#000;font-size:13px;font-weight:700;padding:10px 18px;border-radius:9px;opacity:0;pointer-events:none;transform:translateY(8px);transition:all 0.25s;z-index:1000; }
        .toast.show { opacity:1;transform:translateY(0); }
    </style>
</head>
<body>
<div id="sp"></div>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="grid-bg"></div>

<nav class="z1">
    <a class="nl" href="/">
        <img src="/logo.svg" alt="ALM">
        <span>ALM <span class="nl-sub">/ Manifest</span></span>
    </a>
    <div class="nr">
        <a href="/">Chat</a>
        <a href="/agent">Profile</a>
        <a href="/registry">Registry</a>
        <a href="https://github.com/ALM-AI552/alm-agent" target="_blank">GitHub</a>
        <span class="nbadge">OpenClaw</span>
    </div>
</nav>

<div class="page z1">
    <div class="hero-area rv">
        <div class="hero-tag">Agent Manifest</div>
        <h1>Skill Manifest</h1>
        <p>Machine-readable capability declaration for OpenClaw and inter-agent discovery.</p>
        <div class="hero-actions">
            <button class="btn-copy" onclick="copyJson()">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                Copy JSON
            </button>
            <a class="btn-raw" href="/api/agent/manifest" target="_blank">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                Raw JSON
            </a>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <span style="font-size:13px">Loading manifest...</span>
    </div>

    <div id="content" style="display:none">
        <div class="section rv d1">
            <div class="section-title">Agent Identity</div>
            <div class="card">
                <div class="info-grid">
                    <div class="info-row"><span class="info-label">Name</span><span class="info-value" id="m-name">—</span></div>
                    <div class="info-row"><span class="info-label">Status</span><span class="info-value"><span class="status-dot"><span class="sdot"></span>Active</span></span></div>
                    <div class="info-row"><span class="info-label">Version</span><span class="info-value" id="m-version">—</span></div>
                    <div class="info-row"><span class="info-label">Protocol</span><span class="info-value" id="m-protocol">—</span></div>
                    <div class="info-row full"><span class="info-label">Description</span><span class="info-value" id="m-desc">—</span></div>
                    <div class="info-row full"><span class="info-label">Wallet Address</span><span class="info-value mono" id="m-wallet">—</span></div>
                    <div class="info-row full"><span class="info-label">Agent ID</span><span class="info-value mono" id="m-agentid">—</span></div>
                </div>
            </div>
        </div>

        <div class="section rv d2" id="skills-section" style="display:none">
            <div class="section-title">Skills</div>
            <div id="skills-list"></div>
        </div>

        <div class="section rv d2" id="caps-section" style="display:none">
            <div class="section-title">Capabilities</div>
            <div class="card"><div class="caps-grid" id="caps-list"></div></div>
        </div>

        <div class="section rv d3" id="config-section" style="display:none">
            <div class="section-title">Config</div>
            <div class="card"><div id="config-table"></div></div>
        </div>

        <div class="section rv d3" id="stats-section" style="display:none">
            <div class="section-title">Stats</div>
            <div class="card"><div id="stats-table"></div></div>
        </div>

        <div class="section rv">
            <div class="section-title">Raw JSON</div>
            <pre class="json-block" id="raw-json"></pre>
        </div>
    </div>
</div>

<div class="toast" id="toast">Copied!</div>

<script>
const sp = document.getElementById('sp');
window.addEventListener('scroll', () => {
    sp.style.width = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight) * 100) + '%';
}, {passive:true});
const ro = new IntersectionObserver(entries => entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('vis'); }), {threshold:0.05,rootMargin:'-10px'});
document.querySelectorAll('.rv').forEach(el => ro.observe(el));

const SKILL_ICONS = {
    'balance-checker': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-4 0v2"/></svg>',
    'price-monitor':   '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>',
    'transaction-analyzer': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>',
    'network-status':  '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
};
const DEFAULT_ICON = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="9" x2="15" y2="9"/><line x1="9" y1="13" x2="15" y2="13"/></svg>';

let rawManifest = null;

function cfgRows(obj) {
    return Object.entries(obj).filter(([,v]) => v != null && typeof v !== 'object')
        .map(([k,v]) => '<div class="cfg-row"><span class="cfg-key">'+k+'</span><span class="cfg-val">'+v+'</span></div>')
        .join('');
}

async function loadManifest() {
    try {
        const [mRes, aRes] = await Promise.all([fetch('/api/agent/manifest'), fetch('/api/agent')]);
        const manifest = await mRes.json();
        const agentData = await aRes.json();
        rawManifest = manifest;

        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        document.querySelectorAll('#content .rv').forEach(el => ro.observe(el));

        document.getElementById('m-name').textContent     = manifest.agent?.name || '—';
        document.getElementById('m-version').textContent  = manifest.agent?.version || manifest.version || '—';
        document.getElementById('m-protocol').textContent = manifest.protocol || '—';
        document.getElementById('m-desc').textContent     = manifest.agent?.description || '—';
        document.getElementById('m-wallet').textContent   = agentData?.profile?.publicKey || '(not set)';
        document.getElementById('m-agentid').textContent  = agentData?.profile?.id || manifest.config?.agentId || '—';

        if (manifest.skills?.length) {
            document.getElementById('skills-section').style.display = 'block';
            const list = document.getElementById('skills-list');
            manifest.skills.forEach(skill => {
                const icon = SKILL_ICONS[skill.name] || DEFAULT_ICON;
                const params = (skill.parameters||[]).map(p =>
                    '<span class="param-tag">'+p.name+(p.required?'<span class="param-req">*</span>':'')+'</span>'
                ).join('');
                list.innerHTML +=
                    '<div class="skill-item">' +
                    '<div class="skill-icon">'+icon+'</div>' +
                    '<div class="skill-body"><div class="skill-name">'+skill.name+'</div>' +
                    '<div class="skill-desc">'+(skill.description||'')+'</div>' +
                    (params ? '<div class="skill-params">'+params+'</div>' : '') + '</div>' +
                    '<div><span class="skill-category">'+(skill.category||'general')+'</span>' +
                    '<div class="skill-handler">'+(skill.handler?skill.handler.substring(0,10)+'…':'')+'</div></div>' +
                    '</div>';
            });
        }

        if (manifest.agent?.capabilities?.length) {
            document.getElementById('caps-section').style.display = 'block';
            document.getElementById('caps-list').innerHTML = manifest.agent.capabilities.map(c =>
                '<span class="cap-badge">'+c+'</span>'
            ).join('');
        }

        if (manifest.config && Object.keys(manifest.config).length) {
            document.getElementById('config-section').style.display = 'block';
            document.getElementById('config-table').innerHTML = cfgRows(manifest.config);
        }

        if (manifest.stats && Object.keys(manifest.stats).length) {
            document.getElementById('stats-section').style.display = 'block';
            document.getElementById('stats-table').innerHTML = cfgRows(manifest.stats);
        }

        document.getElementById('raw-json').textContent = JSON.stringify(manifest, null, 2);
    } catch(err) {
        document.getElementById('loading').innerHTML =
            '<div style="color:#ef4444;text-align:center"><div style="font-size:22px;margin-bottom:8px">!</div><div>'+err.message+'</div></div>';
    }
}

function copyJson() {
    if (!rawManifest) return;
    navigator.clipboard.writeText(JSON.stringify(rawManifest, null, 2)).then(() => {
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 1800);
    });
}

loadManifest();
</script>
</body>
</html>